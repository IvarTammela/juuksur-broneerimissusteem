generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// ─── Auth Models ────────────────────────────────────────────

model User {
  id           String   @id @default(cuid())
  name         String
  email        String   @unique
  passwordHash String
  role         UserRole @default(ADMIN)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

enum UserRole {
  ADMIN
  SUPER_ADMIN
}

// ─── Domain Models ──────────────────────────────────────────

model Barber {
  id           String          @id @default(cuid())
  name         String
  email        String?         @unique
  phone        String?
  bio          String?         @db.Text
  bioEt        String?         @db.Text
  imageUrl     String?
  isActive     Boolean         @default(true)
  sortOrder    Int             @default(0)
  services     BarberService[]
  schedules    WorkSchedule[]
  appointments Appointment[]
  breaks       ScheduleBreak[]
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt

  @@index([isActive])
}

model Service {
  id            String          @id @default(cuid())
  name          String
  nameEt        String
  description   String?         @db.Text
  descriptionEt String?         @db.Text
  category      String?
  categoryEt    String?
  isActive      Boolean         @default(true)
  sortOrder     Int             @default(0)
  barbers       BarberService[]
  appointments  Appointment[]
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt

  @@index([isActive])
}

model BarberService {
  id        String  @id @default(cuid())
  barberId  String
  serviceId String
  price     Decimal @db.Decimal(10, 2)
  duration  Int // minutes
  isActive  Boolean @default(true)
  barber    Barber  @relation(fields: [barberId], references: [id], onDelete: Cascade)
  service   Service @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@unique([barberId, serviceId])
  @@index([barberId])
  @@index([serviceId])
}

model WorkSchedule {
  id        String  @id @default(cuid())
  barberId  String
  dayOfWeek Int // 0=Sunday, 1=Monday ... 6=Saturday
  startTime String // "09:00"
  endTime   String // "18:00"
  isWorking Boolean @default(true)
  barber    Barber  @relation(fields: [barberId], references: [id], onDelete: Cascade)

  @@unique([barberId, dayOfWeek])
  @@index([barberId])
}

model ScheduleBreak {
  id        String  @id @default(cuid())
  barberId  String
  dayOfWeek Int
  startTime String // "12:00"
  endTime   String // "13:00"
  label     String?
  barber    Barber  @relation(fields: [barberId], references: [id], onDelete: Cascade)

  @@index([barberId, dayOfWeek])
}

model Appointment {
  id          String            @id @default(cuid())
  barberId    String
  serviceId   String
  clientName  String
  clientEmail String?
  clientPhone String
  date        DateTime          @db.Date
  startTime   String // "14:30"
  endTime     String // "15:00"
  status      AppointmentStatus @default(CONFIRMED)
  notes       String?           @db.Text
  adminNotes  String?           @db.Text
  totalPrice  Decimal           @db.Decimal(10, 2)
  locale      String            @default("et")
  barber      Barber            @relation(fields: [barberId], references: [id])
  service     Service           @relation(fields: [serviceId], references: [id])
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt

  @@index([barberId, date])
  @@index([date])
  @@index([status])
  @@index([clientPhone])
}

enum AppointmentStatus {
  CONFIRMED
  CANCELLED
  COMPLETED
  NO_SHOW
}

model SalonSettings {
  id               String   @id @default("default")
  salonName        String   @default("Juuksurisalong")
  salonNameEt      String   @default("Juuksurisalong")
  address          String?
  phone            String?
  email            String?
  timeSlotInterval Int      @default(15)
  bookingLeadTime  Int      @default(60)
  maxAdvanceDays   Int      @default(30)
  updatedAt        DateTime @updatedAt
}
